<!DOCTYPE html>
<html>
    <head>
    </head>
    <body>
        <h1>Robocharts </h1>
        <p class="num_traded_today"></p>
        <script>
              var getData = url => {
                return new Promise( async function( resolve, reject ) {
                    function inner_get( url ) {
                        var xhttp = new XMLHttpRequest();
                        xhttp.open( "GET", url, true );
                        xhttp.send();
                        return xhttp;
                    }
                    var data = inner_get( url );
                    data.onerror = function( e ) {
                        resolve( "error" );
                    }
                    async function isResponseReady() {
                        return new Promise( function( resolve2, reject ) {
                            if ( !data.responseText || data.readyState != 4 ) {
                                setTimeout( async function() {
                                    var msg = await isResponseReady();
                                    resolve2( msg );
                                }, 1 );
                            } else {
                                resolve2( data.responseText );
                            }
                        });
                    }
                    var returnable = await isResponseReady();
                    resolve( returnable );
                });
            }

            async function getBitcoinPriceFromCoindesk() {
                var data = await getData( "https://api.coindesk.com/v1/bpi/currentprice.json" );
                if ( data == "error" ) return 0;
                var json = JSON.parse( data );
                var price = json[ "bpi" ][ "USD" ][ "rate_float" ];
                return price;
            }

            (async()=>{
                var $ = document.querySelector.bind( document );
                btc_price = await getBitcoinPriceFromCoindesk();
                var num_traded_today = btc_price
                $( '.num_traded_today' ).innerText = `${num_traded_today} btc`;
            })();

        </script>            
    </body>
</html>